---
title: "Time Series - Covid-19Proj"
author: "Tai Chowdhury and Simerpreet Kaur"
date: "3/27/2021"
output: html_document
---

# Datasets:
1) All Covid
2) Post Vaccine

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tswge)
All_Covid <- read_csv("All_Covid.csv")

Post_Vaccine <- read_csv("Post_Vaccine.csv")


```



#############
#### EDA ####
#############

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


# All Covid Data
plotts.wge(All_Covid$new_cases_per_million)
plotts.wge(All_Covid$icu_patients_per_million)
plotts.wge(All_Covid$hosp_patients_per_million)
plotts.wge(All_Covid$new_vaccinations_smoothed_per_million)
plotts.wge(All_Covid$new_deaths_per_million)

# Post Vaccine
plotts.wge(Post_Vaccine$new_cases_per_million)
plotts.wge(Post_Vaccine$icu_patients_per_million)
plotts.wge(Post_Vaccine$hosp_patients_per_million)
plotts.wge(Post_Vaccine$new_vaccinations_smoothed_per_million)
plotts.sample.wge(Post_Vaccine$new_deaths_per_million)

```

## ARMA Model 1

```{r}
pq_m1 <- aic.wge(Post_Vaccine$new_deaths_per_million) #picks p = 3 q = 2
factor.wge(pq_m1$phi) #close to unit circle but we will continue with the model.
factor.wge(pq_m1$theta)
est_m1 = est.arma.wge(Post_Vaccine$new_deaths_per_million, p = 3, q = 2)
mean(Post_Vaccine$new_deaths_per_million) #mean = 7.093083
est_m1$aic #.96057

m1_forcast_short = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_m1$p, theta = est_m1$theta, 
                         n.ahead = 10, lastn = T)
For_ase_m1_10 = mean((m1_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_ase_m1_10 #2.943246


```

## ARMA Model 2 - give range for AIC5

```{r pressure, echo=FALSE}
pq_m2 <- aic.wge(Post_Vaccine$new_deaths_per_million, p = 0:13, q = 0:8) # picks (8,1)
factor.wge(pq_m2$phi) #close to unit circle but we will continue with the model.
factor.wge(pq_m2$theta)
est_m2 = est.arma.wge(Post_Vaccine$new_deaths_per_million, p = 8, q = 1)
mean(Post_Vaccine$new_deaths_per_million) #mean = 7.093083
est_m2$aic #0.5467847

m2_forcast_short = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_m2$p, theta = est_m2$theta, 
                         n.ahead = 10, lastn = T)
For_ase_m2_10 = mean((m2_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_ase_m2_10 #0.6871846
```

#### stationarize our dependant variable  ####


```{r pressure, echo=FALSE}
wn_dr = artrans.wge(Post_Vaccine$new_deaths_per_million,est_arma$phi)
wn_dr
```

#### Factor Table  ####


```{r pressure, echo=FALSE}
factor.wge(est_arma$phi)
```

#### Forecast with ARMA (10 days) ####


```{r pressure, echo=FALSE}

for_arma = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_arma$p, theta = est_arma$theta, 
                         n.ahead = 10, lastn = T)
For_arma_ase = mean((for_arma$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_arma_ase #2.943246 
```


#### Forecast with ARIMA (10 days) ####


```{r pressure, echo=FALSE}
# weekly term (1/.1369 = 6.67 or aprox. 7)
for_aruma = fore.aruma.wge(Post_Vaccine$new_deaths_per_million, phi = est_arma$p, theta = est_arma$theta, 
                           s = 7, n.ahead = 10, lastn = T)

For_aruma_ase = mean((for_aruma$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_aruma_ase #1.856851
```


#### Forecast with ARMA (25 days) ####


```{r pressure, echo=FALSE}
for_arma_25 = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_arma$p, theta = est_arma$theta, 
                         n.ahead = 25, lastn = T)

For_arma_ase_25 = mean((for_arma$f - Post_Vaccine$new_deaths_per_million[(95-25+1):95])^2)
For_arma_ase_25 #3.634228

```




#### Forecast with ARMA (25 days) ####


```{r pressure, echo=FALSE}
# weekly term (1/.1369 = 6.67 or aprox. 7)


for_aruma_25 = fore.aruma.wge(Post_Vaccine$new_deaths_per_million, phi = est_arma$p, theta = est_arma$theta, 
                           s = 7, n.ahead = 25, lastn = T)

For_aruma_ase_25 = mean((for_aruma$f - Post_Vaccine$new_deaths_per_million[(95-25+1):95])^2)
For_aruma_ase_25 #4.67033

```



#### RollingWindow Function ####


```{r pressure, echo=FALSE}
Rolling_Window_ASE = function(series, trainingSize, horizon, s, d, phis, thetas)
{
  # trainingSize = 70
  # horizon = 12
  ASEHolder = numeric()
  # s = 10
  # d = 0
  # phis = phis
  # thetas = thetas
  for( i in 1:(length(series)-(trainingSize + horizon) + 1))
  {
    forecasts = fore.aruma.wge(series[i:(i+(trainingSize-1))],phi = phis, theta = thetas, s = s, d = d,n.ahead = horizon)
    ASE = mean((series[(trainingSize+i):(trainingSize+ i + (horizon) - 1)] - forecasts$f)^2)
    ASEHolder[i] = ASE
  }
  ASEHolder
  hist(ASEHolder)
  WindowedASE = mean(ASEHolder)
  print(horizon)
  print(trainingSize)
  print("The Summary Statistics for the Rolling Window ASE Are:")
  print(summary(ASEHolder))
  print(paste("The Rolling Window ASE is: ",WindowedASE))
  return(WindowedASE)
}


```




































































