---
title: "Time Series - Covid-19Proj"
author: "Tai Chowdhury and Simerpreet Kaur"
date: "3/27/2021"
output: html_document
---

# Datasets:
1) All Covid
2) Post Vaccine

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tswge)
All_Covid <- read_csv("All_Covid.csv")

Post_Vaccine <- read_csv("Post_Vaccine.csv")


```



#############
#### EDA ####
#############

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


# All Covid Data
plotts.wge(All_Covid$new_cases_per_million)
plotts.wge(All_Covid$icu_patients_per_million)
plotts.wge(All_Covid$hosp_patients_per_million)
plotts.wge(All_Covid$new_vaccinations_smoothed_per_million)
plotts.wge(All_Covid$new_deaths_per_million)

# Post Vaccine
plotts.wge(Post_Vaccine$new_cases_per_million)
plotts.wge(Post_Vaccine$icu_patients_per_million)
plotts.wge(Post_Vaccine$hosp_patients_per_million)
plotts.wge(Post_Vaccine$new_vaccinations_smoothed_per_million)
plotts.sample.wge(Post_Vaccine$new_deaths_per_million)

```

## ARMA Model 1

```{r}
pq_m1 <- aic.wge(Post_Vaccine$new_deaths_per_million) #picks p = 3 q = 2
factor.wge(pq_m1$phi) #close to unit circle but we will continue with the model.
factor.wge(pq_m1$theta)
est_m1 = est.arma.wge(Post_Vaccine$new_deaths_per_million, p = 3, q = 2)
mean(Post_Vaccine$new_deaths_per_million) #mean = 7.093083
est_m1$aic #.96057

m1_forcast_short = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_m1$p, theta = est_m1$theta, 
                         n.ahead = 10, lastn = T)
For_ase_m1_10 = mean((m1_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_ase_m1_10 #2.943246


m1_forcast_long = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_m1$p, theta = est_m1$theta, 
                         n.ahead = 25, lastn = T)
For_ase_m1_25 = mean((m1_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-25+1):95])^2)
For_ase_m1_25 #3.634228

```

## ARMA Model 2 - give range for AIC5

```{r pressure, echo=FALSE}
pq_m2 <- aic.wge(Post_Vaccine$new_deaths_per_million, p = 0:13, q = 0:8) # picks (8,1)
factor.wge(pq_m2$phi) #close to unit circle but we will continue with the model.
factor.wge(pq_m2$theta)
est_m2 = est.arma.wge(Post_Vaccine$new_deaths_per_million, p = 8, q = 1)
mean(Post_Vaccine$new_deaths_per_million) #mean = 7.093083
est_m2$aic #0.5467847

m2_forcast_short = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_m2$p, theta = est_m2$theta, 
                         n.ahead = 10, lastn = T)
For_ase_m2_10 = mean((m2_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_ase_m2_10 #0.6871846

m2_forcast_long = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = est_m2$p, theta = est_m2$theta, 
                         n.ahead = 25, lastn = T)
For_ase_m2_25 = mean((m2_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-25+1):95])^2)
For_ase_m2_25 #3.003448



```

#### ARIMA Model 1 (with no seasonality)


```{r pressure, echo=FALSE}

#Check for white noise
plotts.sample.wge(Post_Vaccine$new_deaths_per_million) #Damped sinusoudal behavior in ACF, also indication of seasonality

Dif_arima1 = artrans.wge(Post_Vaccine$new_deaths_per_million, phi.tr=1)#dif data does not look like white noise
aic5.wge(Dif_arima1) # picks p = 5 q = 2
arima1_est = est.arma.wge(Dif_arima1, p=5, q=2)
mean(Post_Vaccine$new_deaths_per_million) # 7.093083
# check forpresence of (1-B) by overfitting 
of_arima1_est = est.ar.wge(Post_Vaccine$new_deaths_per_million, p=8, type='burg') # (1-B) exist.
of_arima1_est$aic #0.6180465

m3_forcast_short = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = of_arima1_est$p, 
                         n.ahead = 10, lastn = T)
For_ase_m3_10 = mean((m3_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-10+1):95])^2)
For_ase_m3_10 #1.271954

m3_forcast_long = fore.arma.wge(Post_Vaccine$new_deaths_per_million, phi = of_arima1_est$p, 
                         n.ahead = 25, lastn = T)
For_ase_m2_25 = mean((m3_forcast_short$f - Post_Vaccine$new_deaths_per_million[(95-25+1):95])^2)
For_ase_m2_25 #3.071347



```

#### Factor Table  ####


```{r pressure, echo=FALSE}
factor.wge(est_arma$phi)
```





























